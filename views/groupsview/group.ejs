<%- include("../partials/start.ejs") -%>
<%- include("../partials/header.ejs") -%>

<h1><%= group.title %></h1>

<% if(group.description == ""){  %>
<p style="color:gray">Sin descripción</p>
<% }else{ %>
<%= group.description %>
<% } %>


<% if (isadmin){ %>
    <form method="GET" action="/group/<%=encrypted_id%>/newelement">
        <button type="submit">Crear nueva galería o evento</button>
    </form>
<% }%>

<form method="GET" action="/group/<%=encrypted_id%>/members">
    <button type="submit">Miembros</button>
</form>

<form method="GET" action="/group/<%=encrypted_id%>/getlinks">
    <button type="submit">Compartir</button>
</form>

<% if (sections.length>0){%>
    <% sections.forEach((section,index) => { %>
    <form method="GET" action="/group/<%=encrypted_id%>/<%= section.section_type %>/<%=section.id%>" class="section_forms" id="section_form_<%= index %>">
        <% if (section.section_type == "event") {%>
        <h3>Evento</h2>
        <% }else if(section.section_type == "gallery"){ %>
        <h3>Galería</h2>
        <% }%>
        <h2><%=section.title %></h2>
        <p><%=section.description %></p>
    </form>
    <% }) %>
<% }else if(sections.length==0 & isadmin){%>
    <p><%= group.title %> está vacío por ahora ¿Que quieres crear?</p>
    
<% }else{ %>
    <p><%= group.title %> está vacío por ahora</p>
<% } %>
    

<script>
    document.addEventListener("DOMContentLoaded", () => {
        let sections_forms = document.querySelectorAll('.section_forms');
        sections_forms.forEach(form => {
            form.addEventListener('click', () => {
                form.submit();
            });
        });
    });
</script>


<script src="/sweetalert2/sweetalert2.all.min.js"></script>

    <% if (created_element == 1 || created_element == 2) { %>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        let mensaje = ""
        if (<%= created_element %> === 1) {
            mensaje = "Se ha creado la nueva galería correctamente"
        } else if (<%= created_element %> === 2) {
            mensaje = "Se ha creado el nuevo evento correctamente"
        }

        Swal.fire({
            toast: true,
            position: 'top-end',
            icon: 'success',
            title: mensaje,
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true,
        })
    })
 
</script>
   <% } %>

   <% if (unique_code && unique_link) { %>
<script>
document.addEventListener("DOMContentLoaded", () => {
    Swal.fire({
        title: 'Compartir grupo',
        html: `
            <div style="text-align:left">
                <p><strong>Mediante código de invitación:</strong></p>
                <span style="font-size:small">Los que reciban este código deberan insertarlo desde nuestra página web<span>
                <div style="display:flex;align-items:center;gap:5px">
                    <input id="swal-code" value="<%= unique_code %>" readonly style="flex:1;padding:4px;border:1px solid #ccc;border-radius:4px"/>
                    <button onclick="copyToClipboard('swal-code')">📋</button>
                </div>
                <br>
                <p><strong>O mediante enlace:</strong></p>
                <div style="display:flex;align-items:center;gap:5px">
                    <input id="swal-link" value="<%= unique_link %>" readonly style="flex:1;padding:4px;border:1px solid #ccc;border-radius:4px"/>
                    <button onclick="copyToClipboard('swal-link')">📋</button>
                </div>
            </div>
        `,
        showConfirmButton: false,
        showCloseButton: true
    });
});

function copyToClipboard(id) {
    let input = document.getElementById(id);
    input.select();
    input.setSelectionRange(0, 99999); // Para móviles
    document.execCommand("copy");

    Swal.fire({
        toast: true,
        position: 'top-end',
        icon: 'success',
        title: 'Copiado al portapapeles',
        showConfirmButton: false,
        timer: 2000
    });
}
</script>
<% } %>

<style>
    .swal2-container.swal2-top-end {
    top: 5% !important;
    right: 5% !important
    }
</style>

<%- include("../partials/end.ejs") -%>